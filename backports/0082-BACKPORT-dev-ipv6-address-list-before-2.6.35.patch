From: Moni Shoua <monis@mellanox.co.il>
Subject: [PATCH] BACKPORT: dev ipv6 address list before 2.6.35

Change-Id: Icda5e086c0d84d70b5b817e403d77872f2b64a82
Signed-off-by: Moni Shoua <monis@mellanox.co.il>
---
 drivers/infiniband/hw/mlx4/main.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/infiniband/hw/mlx4/main.c b/drivers/infiniband/hw/mlx4/main.c
index xxxxxxx..xxxxxxx xxxxxx
--- a/drivers/infiniband/hw/mlx4/main.c
+++ b/drivers/infiniband/hw/mlx4/main.c
@@ -1875,7 +1875,11 @@ static void mlx4_ib_get_dev_addr(struct net_device *dev, struct mlx4_ib_dev *ibd
 	in6_dev = in6_dev_get(dev);
 	if (in6_dev) {
 		read_lock_bh(&in6_dev->lock);
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(2,6,35))
+		for (ifp = in6_dev->addr_list; ifp; ifp = ifp->if_next) {
+#else
 		list_for_each_entry(ifp, &in6_dev->addr_list, if_list) {
+#endif
 			pgid = (union ib_gid *)&ifp->addr;
 			update_gid_table(ibdev, port, pgid, 0, 0);
 		}
