From 4dcb6f8ea7ea5c770b2473fcd3bac5d937d7e104 Mon Sep 17 00:00:00 2001
From: Eugenia Emantayev <eugenia@mellanox.co.il>
Date: Sun, 7 Jul 2013 15:48:57 +0300
Subject: [PATCH] mlx4_en: Ethernet only

Signed-off-by: Eugenia Emantayev <eugenia@mellanox.com>
---
 drivers/net/ethernet/mellanox/mlx4/main.c |   16 ++++------------
 1 file changed, 4 insertions(+), 12 deletions(-)

diff --git a/drivers/net/ethernet/mellanox/mlx4/main.c b/drivers/net/ethernet/mellanox/mlx4/main.c
index xxxxxxx..xxxxxxx xxxxxx
--- a/drivers/net/ethernet/mellanox/mlx4/main.c
+++ b/drivers/net/ethernet/mellanox/mlx4/main.c
@@ -195,8 +195,8 @@ static struct param_data port_type_array = {
 	.dbdf2val = {
 		.name		= "port_type_array param",
 		.num_vals	= 2,
-		.def_val	= {MLX4_PORT_TYPE_NONE, MLX4_PORT_TYPE_NONE},
-		.range		= {MLX4_PORT_TYPE_IB, MLX4_PORT_TYPE_NA}
+		.def_val	= {MLX4_PORT_TYPE_ETH, MLX4_PORT_TYPE_ETH},
+		.range		= {MLX4_PORT_TYPE_ETH, MLX4_PORT_TYPE_ETH}
 	}
 };
 module_param_string(port_type_array, port_type_array.dbdf2val.str,
@@ -744,16 +744,8 @@ static int mlx4_dev_cap(struct mlx4_dev *dev, struct mlx4_dev_cap *dev_cap)
 					dev->caps.port_type[i] = pta;
 			}
 		}
-		/*
-		 * Link sensing is allowed on the port if 3 conditions are true:
-		 * 1. Both protocols are supported on the port.
-		 * 2. Different types are supported on the port
-		 * 3. FW declared that it supports link sensing
-		 */
-		mlx4_priv(dev)->sense.sense_allowed[i] =
-			((dev->caps.supported_type[i] == MLX4_PORT_TYPE_AUTO) &&
-			 (dev->caps.flags & MLX4_DEV_CAP_FLAG_DPDP) &&
-			 (dev->caps.flags & MLX4_DEV_CAP_FLAG_SENSE_SUPPORT));
+		/* Link sensing is not allowed for ETH only package */
+		mlx4_priv(dev)->sense.sense_allowed[i] = 0;
 
 		/*
 		 * If "default_sense" bit is set, we move the port to "AUTO" mode
-- 
1.7.9.5

